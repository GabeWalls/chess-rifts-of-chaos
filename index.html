<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Chess: Rifts of Chaos</title>
    <link rel="stylesheet" href="styles.css?v=2.0">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7184995528326593"
            crossorigin="anonymous"></script>
</head>
<body>
    <!-- Beta Banner -->
    <div class="beta-banner" id="beta-banner">
        <div class="beta-banner-content">
            <span class="beta-badge">BETA</span>
            <span class="beta-message">This game is currently in beta testing. New to the game? Check out the Rules in the Settings menu (‚öôÔ∏è ‚Üí Rules). If you experience any issues, please document them and report to the developer.</span>
            <button class="beta-close" id="beta-close" aria-label="Close banner">&times;</button>
        </div>
    </div>

    <!-- Settings Menu -->
    <div class="settings-menu">
        <button class="settings-btn" id="settings-btn">‚öôÔ∏è</button>
        <div class="settings-panel" id="settings-panel">
            <div class="setting-item">
                <span>Dark Mode</span>
                <div class="toggle-switch" id="dark-mode-toggle"></div>
            </div>
            <div class="setting-item clickable" id="rules-btn">
                <span>üìñ Rules</span>
            </div>
        </div>
    </div>

    <div class="game-container">
        <header class="game-header">
            <h1>‚ôüÔ∏è Chess: Rifts of Chaos ‚ôüÔ∏è</h1>
            <div class="game-info">
                <div class="current-player">
                    Current Player: <span id="current-player">White</span>
                </div>
                <div class="game-phase">
                    Game Phase: <span id="game-phase">Setup - Place Rifts</span>
                </div>
            </div>
        </header>

        <main class="game-main">
            <div class="chess-board-container">
                <div class="board-with-side-coords">
                    <!-- Left coordinates (8-1) -->
                    <div class="board-coordinates left-coords">
                        <div class="coord-label" data-row="0">8</div>
                        <div class="coord-label" data-row="1">7</div>
                        <div class="coord-label" data-row="2">6</div>
                        <div class="coord-label" data-row="3">5</div>
                        <div class="coord-label" data-row="4">4</div>
                        <div class="coord-label" data-row="5">3</div>
                        <div class="coord-label" data-row="6">2</div>
                        <div class="coord-label" data-row="7">1</div>
                    </div>
                    
                    <div id="chess-board" class="chess-board">
                        <!-- Board will be generated by JavaScript -->
                        <!-- Sandstorm overlay -->
                        <div id="sandstorm-overlay" class="sandstorm-overlay"></div>
                    </div>
                </div>
                
                <!-- Bottom coordinates (A-H) -->
                <div class="board-coordinates bottom-coords">
                    <div class="coord-spacer"></div>
                    <div class="coord-label" data-col="0">A</div>
                    <div class="coord-label" data-col="1">B</div>
                    <div class="coord-label" data-col="2">C</div>
                    <div class="coord-label" data-col="3">D</div>
                    <div class="coord-label" data-col="4">E</div>
                    <div class="coord-label" data-col="5">F</div>
                    <div class="coord-label" data-col="6">G</div>
                    <div class="coord-label" data-col="7">H</div>
                    <div class="coord-spacer"></div>
                </div>
            </div>

            <div class="game-controls">
                <div class="setup-controls" id="setup-controls">
                    <h3>Setup Phase</h3>
                    <p>Place 4 rifts on rows 3, 4, 5, or 6. No two rifts can share the same row or column.</p>
                    <div class="rift-counter">
                        Rifts Placed: <span id="rift-count">0</span>/4
                    </div>
                    <button id="random-rifts" class="btn">Generate Random Rifts</button>
                    <button id="start-game" class="btn primary" disabled>Start Game</button>
                </div>

                <div class="game-controls-panel" id="game-controls-panel" style="display: none;">
                    <h3>Game Controls</h3>
                    
                    <!-- Multiplayer Status -->
                    <div id="multiplayer-status" class="multiplayer-status" style="display: none;">
                        <h4>Players in Room</h4>
                        <div id="room-players-display" class="room-players-display"></div>
                        <div id="room-spectators-display" class="room-spectators-display"></div>
                    </div>
                    <div class="captured-pieces">
                        <h4>Captured Pieces</h4>
                        <div class="captured-white">
                            <span>White:</span>
                            <div id="captured-white-pieces"></div>
                        </div>
                        <div class="captured-black">
                            <span>Black:</span>
                            <div id="captured-black-pieces"></div>
                        </div>
                    </div>
                    <div class="active-effects" id="active-effects">
                        <h4>Active Field Effects</h4>
                        <div id="field-effects-list"></div>
                    </div>
                    <div class="game-log">
                        <h4>Game Log</h4>
                        <div id="game-log-content" class="log-content"></div>
                    </div>
                    <div class="chat-section">
                        <h4>Chat</h4>
                        <div id="chat-messages" class="chat-messages"></div>
                        <div class="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Type a message..." maxlength="100">
                            <button id="send-chat" class="btn small">Send</button>
                        </div>
                    </div>
                    <button id="resign-btn" class="btn danger">Resign</button>
                </div>
            </div>
        </main>

        <!-- Multiplayer Button -->
        <div class="multiplayer-controls">
            <button id="multiplayer-btn" class="btn">üéÆ Multiplayer</button>
        </div>
        
        <!-- Ad Placement - Top Banner -->
        <div class="ad-container ad-banner-top">
            <!-- Replace with your actual ad code from AdSense dashboard -->
            <!-- 
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-7184995528326593"
                 data-ad-slot="YOUR_TOP_BANNER_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
            -->
        </div>

        <div class="rift-effects-modal" id="rift-effects-modal" style="display: none;">
            <div class="modal-content">
                <h3 id="rift-effect-title">Rift Effect</h3>
                <div id="rift-effect-description"></div>
                <div class="dice-roll">
                    <div class="dice-display">
                        <span id="dice-result">?</span>
                    </div>
                    <button id="roll-dice" class="btn">Roll D20</button>
                </div>
                <div id="rift-effect-options" class="effect-options"></div>
                <button id="close-modal" class="btn">Close</button>
            </div>
        </div>

        <div class="victory-modal" id="victory-modal" style="display: none;">
            <div class="modal-content">
                <h2 id="victory-message">Victory!</h2>
                <button id="new-game" class="btn primary">New Game</button>
            </div>
        </div>

        <!-- Multiplayer Room Modal -->
        <div class="room-modal" id="room-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Join Multiplayer Game</h3>
                    <button class="close-btn" id="close-room-modal">&times;</button>
                </div>
                <div class="room-inputs">
                    <input type="text" id="room-code-input" placeholder="Enter room code (e.g., ABC123)" maxlength="6">
                    <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="20">
                    <button id="join-room-btn" class="btn primary">Join Room</button>
                    <button id="create-room-btn" class="btn">Create New Room</button>
                </div>
                <div class="room-info" id="room-info" style="display: none;">
                    <h4>Room: <span id="current-room-code"></span></h4>
                    <div class="players-list">
                        <h5>Players:</h5>
                        <div id="players-list"></div>
                    </div>
                    <div class="spectators-list">
                        <h5>Spectators:</h5>
                        <div id="spectators-list"></div>
                    </div>
                    <div class="coin-flip-result" id="coin-flip-result" style="display: none;">
                        <p>Coin flip result: <span id="coin-flip-text"></span></p>
                    </div>
                </div>
                <button id="leave-room-btn" class="btn danger" style="display: none;">Leave Room</button>
            </div>
        </div>

        <!-- Rules Modal -->
        <div class="rules-modal" id="rules-modal" style="display: none;">
            <div class="modal-content rules-content">
                <div class="modal-header">
                    <h2>Chess: Rifts of Chaos - Game Rules</h2>
                    <button class="close-btn" id="close-rules-modal">&times;</button>
                </div>
                <div class="rules-body">
                    <!-- Tab Navigation -->
                    <div class="rules-tabs">
                        <button class="tab-btn active" data-tab="intro">Intro</button>
                        <button class="tab-btn" data-tab="setup">Setup</button>
                        <button class="tab-btn" data-tab="gameplay">Gameplay</button>
                        <button class="tab-btn" data-tab="effects">Effects</button>
                        <button class="tab-btn" data-tab="rules">Rules</button>
                        <button class="tab-btn" data-tab="rifts">All Rifts</button>
                    </div>

                    <!-- Tab Content -->
                    <!-- Tab 1: Introduction -->
                    <div class="rules-tab-content active" id="rules-tab-intro">
                        <h3>Introduction</h3>
                        <p>A chaotic twist on classic chess where rifts alter the battlefield.</p>
                    </div>

                    <!-- Tab 2: Setup -->
                    <div class="rules-tab-content" id="rules-tab-setup">
                        <h3>1. Setup</h3>
                        <ol>
                            <li><strong>Determine Rift Locations</strong>
                                <ul>
                                    <li>Before placing pieces, choose <strong>4 rift spaces</strong> on the board.</li>
                                    <li>Rifts may only be placed on rows <strong>3, 4, 5, or 6</strong>.</li>
                                    <li>No two rifts can share the same row or column.</li>
                                    <li>If your selection method places rifts in the same row or column, re-roll/re-draw until valid.</li>
                                </ul>
                                <p><strong>Ways to select rifts creatively:</strong></p>
                                <ul>
                                    <li>Write rows/columns on paper and draw from a hat.</li>
                                    <li>Spin a marked wheel.</li>
                                    <li>Roll a D8 (for columns/rows).</li>
                                </ul>
                            </li>
                            <li><strong>Mark Rift Spaces</strong>
                                <ul>
                                    <li>Overlay a clear sheet and draw swirls with dry-erase marker.</li>
                                    <li>Place paper or cardboard circles on chosen squares.</li>
                                </ul>
                            </li>
                            <li><strong>Place Pieces</strong>
                                <ul>
                                    <li>Set up all chess pieces in their standard starting positions.</li>
                                </ul>
                            </li>
                            <li><strong>Decide First Player</strong>
                                <ul>
                                    <li>Flip a coin, roll dice, or use any agreed method.</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <!-- Tab 3: Core Gameplay -->
                    <div class="rules-tab-content" id="rules-tab-gameplay">
                        <h3>2. Core Gameplay</h3>
                        <ul>
                            <li>Play <strong>standard chess rules</strong>, except when a piece lands on a rift square.</li>
                            <li>When a piece moves onto a rift:
                                <ol>
                                    <li>Roll a <strong>D20</strong> to determine the effect.</li>
                                    <li>Apply the effect immediately.</li>
                                </ol>
                            </li>
                        </ul>
                    </div>

                    <!-- Tab 4: Rift Effects Overview -->
                    <div class="rules-tab-content" id="rules-tab-effects">
                        <h3>3. Rift Effects</h3>
                        <ol>
                            <li><strong>Rift Rankings (‚òÜ ‚Äì ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ)</strong>
                                <ul>
                                    <li>‚òÜ ‚Äî Purely negative for you, possibly positive for opponent.</li>
                                    <li>‚òÜ‚òÜ ‚Äî Negative for both players.</li>
                                    <li>‚òÜ‚òÜ‚òÜ ‚Äî Neutral/equal effect on both players.</li>
                                    <li>‚òÜ‚òÜ‚òÜ‚òÜ ‚Äî Mostly positive for you, with some drawbacks.</li>
                                    <li>‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ ‚Äî Strongly positive for you, possibly negative for opponent.</li>
                                </ul>
                            </li>
                            <li><strong>Types of Rifts</strong>
                                <ul>
                                    <li><strong>Special Effects</strong>
                                        <ul>
                                            <li>Trigger once, then end.</li>
                                            <li>May apply to one or both players.</li>
                                            <li>Some require conditions to be met; if unmet, re-roll the D20.</li>
                                            <li>After resolution, play passes to the opponent.</li>
                                        </ul>
                                    </li>
                                    <li><strong>Field Effects</strong>
                                        <ul>
                                            <li>Alter game rules until replaced.</li>
                                            <li>Only one field effect can be active at a time.</li>
                                            <li>A new field effect cancels the current one.</li>
                                            <li>If the same field effect is activated twice, both are canceled.</li>
                                            <li>Keep track of active effects (e.g., on a whiteboard).</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <!-- Tab 5: Additional Rules -->
                    <div class="rules-tab-content" id="rules-tab-rules">
                        <h3>4. Additional Rules</h3>
                        <ul>
                            <li><strong>Kings</strong>
                                <ul>
                                    <li>Cannot activate a rift, but can be affected by rift effects.</li>
                                </ul>
                            </li>
                            <li><strong>Activation Limits</strong>
                                <ul>
                                    <li>A rift may only activate once per turn.</li>
                                    <li>If an effect moves a piece onto another rift during the same turn, that second rift does <strong>not</strong> trigger.</li>
                                </ul>
                            </li>
                            <li><strong>Victory Conditions</strong>
                                <ul>
                                    <li>Standard win: checkmate your opponent's king.</li>
                                    <li>If a rift removes a king from play, that player immediately loses.</li>
                                </ul>
                            </li>
                            <li><strong>Priority Rule</strong>
                                <ul>
                                    <li>Field effects always take precedence over other rift rolls.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>

                    <!-- Tab 6: All Rift Effects -->
                    <div class="rules-tab-content" id="rules-tab-rifts">
                        <h3>5. Complete Rift Effect List</h3>
                        <div class="rift-effects-list">
                            <div class="effect-item">
                                <strong>1. Necromancer's Trap (‚òÜ, Special)</strong>
                                <ul>
                                    <li>Remove your piece.</li>
                                    <li>Place one of your opponent's captured pieces onto the rift.</li>
                                    <li><em>Requirement: opponent must have a captured piece.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>2. Archer's Trick Shot (‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Choose a direction from the rift; also applies to two adjacent directions.</li>
                                    <li>Range: 3 squares per direction.</li>
                                    <li>Remove the first piece encountered.</li>
                                    <li><em>Requirement: enemy piece within 3 squares.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>3. Sandworm (‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Remove all pieces within 1 square of the rift, plus the activating piece.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>4. Honorable Sacrifice (‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Remove your activating piece and any one piece within 1 square.</li>
                                    <li><em>Requirement: enemy piece within 1 square.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>5. Demotion (‚òÜ, Special)</strong>
                                <ul>
                                    <li>Remove your activating piece.</li>
                                    <li>If it was a Castle, Knight, Bishop, or Queen, place a captured Pawn of yours on the rift.</li>
                                    <li><em>Requirement: must have a captured Pawn.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>6. Foot Soldier's Gambit (‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>The activating piece must immediately move again.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>7. Famine (‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>Pawns cannot move.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>8. Holiday's Rejuvenation (‚òÜ‚òÜ‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>Pawns may move two spaces forward.</li>
                                    <li>Castles, Bishops, Queens can jump over 1 friendly piece (moving 1 space beyond).</li>
                                    <li>Knights move 3 + 1 instead of 2 + 1.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>9. Sandstorm (‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>Pawns cannot move.</li>
                                    <li>Knights move only 1 square.</li>
                                    <li>Castles, Bishops, Queens max range: 3 squares.</li>
                                    <li>Kings cannot move unless in check.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>10. Dragon's Breath (‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Choose a direction; remove any piece up to 3 squares away in a straight line.</li>
                                    <li><em>Requirement: enemy piece within 3 squares.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>11. Jack Frost's Mischief (‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>After moving, roll a D20:
                                        <ul>
                                            <li>Odd = nothing happens.</li>
                                            <li>Even = piece moves 1 extra square in same direction.</li>
                                        </ul>
                                    </li>
                                    <li>If movement would collide with a piece, neither moves; both are frozen next turn.</li>
                                    <li>If movement pushes off-board, the piece is removed.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>12. Portal in the Rift (‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Move the activating piece to another unactivated rift.</li>
                                    <li>If that rift is occupied, the occupying piece is removed.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>13. Catapult Roulette (‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Roll 2D8 to choose a random square (column A‚ÄìH, row 1‚Äì8).</li>
                                    <li>Remove any piece on that square.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>14. Conqueror's Tale (‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Your king gains the ability to move twice per turn for the rest of the game.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>15. Medusa's Gaze (‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>The activating piece is frozen in place and cannot be moved/removed (except by other rifts).</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>16. Time Distortion/Stasis (‚òÜ‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>All pieces within a radius are frozen (cannot move).</li>
                                    <li>Radius = D20 roll:
                                        <ul>
                                            <li>1‚Äì8 = 1 square, 9‚Äì14 = 2, 15‚Äì18 = 3, 19‚Äì20 = 4.</li>
                                        </ul>
                                    </li>
                                    <li>Kings inside radius may only move if checked.</li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>17. Crossroad Demon's Deal (‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>You may decline this effect before rolling.</li>
                                    <li>If accepted: remove your activating piece, roll a D20.
                                        <ul>
                                            <li>Odd = remove 1 more of your pieces (choice).</li>
                                            <li>Even = remove 2 more of your pieces (choice).</li>
                                        </ul>
                                    </li>
                                    <li>Opponent chooses one of your non-Pawn captured pieces to place on the rift.</li>
                                    <li><em>Requirement: you must have 1 non-Pawn captured piece and 2 non-King pieces on board.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>18. Fairy Fountain (‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Activating Pawn gains new movement:
                                        <ul>
                                            <li>Forward 2 spaces, plus 1 space left/right.</li>
                                        </ul>
                                    </li>
                                    <li><em>Requirement: must be activated by a Pawn.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>19. Eerie Fog's Turmoil (‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>At the start of your turn, roll a D20.
                                        <ul>
                                            <li>3‚Äì20 = play normally.</li>
                                            <li>1‚Äì2 = skip your turn.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>20. Spring of Revival (‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ, Special)</strong>
                                <ul>
                                    <li>Place one of your captured pieces onto a starting square.</li>
                                    <li><em>Requirement: must have at least 1 captured piece.</em></li>
                                </ul>
                            </div>
                            <div class="effect-item">
                                <strong>21. Blank (‚òÜ‚òÜ‚òÜ, Field)</strong>
                                <ul>
                                    <li>Pawns may now move sideways to capture.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ad Placement - Sidebar (Desktop Only) -->
    <div class="ad-container ad-sidebar">
        <!-- Replace with your actual sidebar ad code from AdSense dashboard -->
        <!-- 
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-7184995528326593"
             data-ad-slot="YOUR_SIDEBAR_SLOT_ID"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        -->
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="chess-game.js?v=2.0"></script>
</body>
</html>
